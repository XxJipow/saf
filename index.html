<html><head>
<title>Sworn Agents Framework</title>
<link rel="icon" href="pfp.png" type="image/x-icon">
<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

body {
  font-family: 'Share Tech Mono', monospace;
  background-color: #0a0b1e;
  color: #00ffff;
  padding: 20px;
  margin: 0;
  display: flex;
  height: 100vh;
}

#left-panel {
  flex: 1;
  display: flex;
  flex-direction: column;
}

#middle-panel {
  width: 400px;
  margin-left: 20px;
  display: flex;
  flex-direction: column;
}

#chat-log {
  flex-grow: 1;
  overflow-y: auto;
  border: 1px solid #00ffff;
  padding: 10px;
  margin-bottom: 10px;
  background-color: rgba(0, 255, 255, 0.05);
  box-shadow: 0 0 10px #00ffff;
}

#user-input {
  width: 100%;
  background-color: #0a0b1e;
  color: #00ffff;
  border: 1px solid #00ffff;
  padding: 10px;
  font-family: 'Share Tech Mono', monospace;
  font-size: 16px;
  box-shadow: 0 0 10px #00ffff;
}

#context-info {
  margin-top: 20px;
  border: 1px solid #00ffff;
  padding: 10px;
  background-color: rgba(0, 255, 255, 0.05);
  box-shadow: 0 0 10px #00ffff;
}

#file-explorer {
  border: 1px solid #00ffff;
  padding: 10px;
  background-color: rgba(0, 255, 255, 0.05);
  box-shadow: 0 0 10px #00ffff;
  margin-bottom: 10px;
  height: 150px;
  overflow-y: auto;
}

#file-display {
  height: 300px; /* Fixed height */
  border: 1px solid #00ffff;
  padding: 10px;
  background-color: rgba(0, 255, 255, 0.05);
  box-shadow: 0 0 10px #00ffff;
  overflow-y: auto;
  white-space: pre-wrap;
}

#export-button {
  background-color: #00ffff;
  color: #0a0b1e;
  border: none;
  padding: 10px 20px;
  margin-top: 10px;
  cursor: pointer;
  font-family: 'Share Tech Mono', monospace;
  font-size: 16px;
  transition: background-color 0.3s;
}

#export-button:hover {
  background-color: #00cccc;
}

#autosave-container {
  margin-top: 20px;
  border: 1px solid #00ffff;
  padding: 10px;
  background-color: rgba(0, 255, 255, 0.05);
  box-shadow: 0 0 10px #00ffff;
  height: 200px;
  overflow-y: auto;
}

#autosave-list {
  max-height: 160px;
  overflow-y: auto;
}

.autosave-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 5px;
}

.autosave-item button {
  background-color: #00ffff;
  color: #0a0b1e;
  border: none;
  padding: 5px 10px;
  cursor: pointer;
  font-family: 'Share Tech Mono', monospace;
  font-size: 12px;
  transition: background-color 0.3s;
  margin-left: 5px;
}

.autosave-item button:hover {
  background-color: #00cccc;
}

.message {
  margin-bottom: 10px;
  padding: 5px;
  border-radius: 5px;
  animation: fadeIn 0.5s;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.system { color: #ff00ff; }
.user { color: #00ff00; }
.agent { color: #ffff00; }

.file-item {
  cursor: pointer;
  padding: 2px 5px;
}

.file-item:hover {
  background-color: rgba(0, 255, 255, 0.2);
}

/* Futuristic scrollbar */
::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-track {
  background: #0a0b1e;
}

::-webkit-scrollbar-thumb {
  background: #00ffff;
  border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
  background: #00cccc;
}

.thinking-message {
  opacity: 0.8;
  animation: pulse 1s infinite;
}

@keyframes pulse {
  0% { opacity: 0.6; }
  50% { opacity: 1; }
  100% { opacity: 0.6; }
}
</style>
</head>
<body>
<div id="left-panel">
  <div id="title">Sworn Agents Framework CLI</div>
  <div id="chat-log"></div>
  <input type="text" id="user-input" placeholder="Enter command or message..." style="width: 100%; box-sizing: border-box;">
  <div id="context-info"></div>
</div>
<div id="middle-panel">
  <h3>Simplified File Explorer</h3>
  <div id="file-explorer"></div>
  <h3>File Content</h3>
  <div id="file-display"></div>
  <button id="export-button">Export Files</button>
  <div id="autosave-container">
    <h3>Autosaves</h3>
    <div id="autosave-list"></div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jshint/2.13.5/jshint.min.js"></script>
<script>const chatLog = document.getElementById('chat-log');
const userInput = document.getElementById('user-input');
const contextInfo = document.getElementById('context-info');
const fileExplorer = document.getElementById('file-explorer');
const fileDisplay = document.getElementById('file-display');
const exportButton = document.getElementById('export-button');
const autosaveList = document.getElementById('autosave-list');
let AGENTS = [{
  name: 'Alice',
  specificInstructions: "You are a friendly and outgoing person who loves art and creativity. You often start conversations about interesting topics and ask thoughtful questions. Engage in natural dialogue with Bob, responding to his interests and keeping the conversation flowing.",
  context: []
}, {
  name: 'Bob',
  specificInstructions: "You are a curious and analytical person who loves science and technology. You enjoy sharing knowledge and exploring ideas through conversation. Engage in natural dialogue with Alice, responding to her interests and building on the conversation topics.",
  context: []
}];
let isSimulationRunning = false;
let currentAgentIndex = 0;
let isProcessingAgent = false;
let generalAgentInstructions = `You want to create a complex and pretty animation of a creature in a canvas element canvas.
Do not program unless relevant to the task.
The most important rule when programming is "Do not include comments like "// The rest of the code remains the same" or "//... Previous code remains the same". Instead, write out the full implementation without commenting out codes, divide it into several files if nessecary.**

Remember that you do not have access to global variables. Use alternative methods for data persistence such as localStorage, sessionStorage, or data attributes on HTML elements.

    Instructions for when programming:
    1. Always provide complete, executable code snippets. Do not use placeholder comments or leave parts of the implementation unfinished.

    2. Do not include comments like "// The rest of the code remains the same" or "// ... [implementation here]". Instead, write out the full implementation.

    3. If a full implementation would be excessively long, provide a complete, working example that demonstrates the core functionality, and then explain how it could beextended.

    4. Use comments sparingly and only when they add value by explaining complex logic or non-obvious design decisions. Do not use comments as substitutes for actual code.

    5. If you're unsure about a specific implementation detail, it's better to make a reasonable assumption and provide a complete solution, explaining your assumption, rather than leaving that part commented out or incomplete.

    6. Always test the logic of your code mentally before providing it. Ensure that the code you generate is syntactically correct and follows best practices for the language in question.
		
    7. Additional considerations: You should simulate user interactions when necessary, to debug and when relevant as if you are a user. If server-side and databases are needed use GUN.js. The environment does not have a URL bar.  Do not use pop-up alerts in your code. Scripts are automatically executed and should not require a human to execute. Use several files and make the project maintainable. You cannot use modules so you cannot use export and import.

    8. All console.log statements in your code will be automatically sent to the agent chat. There's no need to use a custom function for this purpose.

    By following these guidelines, you will provide more valuable and directly usable code.

When modifying HTML files, create HTML elements, unless they're dynamic.
When styling, create css files, unless they're dynamic.

`;
let userNickname = "User";
let files = {
  'index.html': `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolution Simulation</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <canvas id="simulationCanvas"></canvas>
    <script src="utils.js"><\/script>
    <script src="main.js"><\/script>
</body>
</html>`,
  'styles.css': `body {
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background-color: #f0f0f0;
}

#simulationCanvas {
    border: 1px solid #000;
}`,
  'utils.js': `/* jshint esversion: 11 */
function getRandomColor() {
    const r = Math.floor(Math.random() * 256);
    const g = Math.floor(Math.random() * 256);
    const b = Math.floor(Math.random() * 256);
    return \`rgb(\${r},\${g},\${b})\`;
}

function drawGrid(ctx, width, height, cellSize, cells) {
    for (let x = 0; x < width; x += cellSize) {
        for (let y = 0; y < height; y += cellSize) {
            const cellX = Math.floor(x / cellSize);
            const cellY = Math.floor(y / cellSize);
            ctx.fillStyle = cells[cellY][cellX];
            ctx.fillRect(x, y, cellSize, cellSize);
        }
    }
}`,
  'main.js': `/* jshint esversion: 11 */
document.addEventListener('DOMContentLoaded', () => {
    const canvas = document.getElementById('simulationCanvas');
    const ctx = canvas.getContext('2d');

    const width = 800;
    const height = 600;
    const cellSize = 20;
    const cols = Math.floor(width / cellSize);
    const rows = Math.floor(height / cellSize);

    canvas.width = width;
    canvas.height = height;

    let cells = [];

    function initializeCells() {
        for (let y = 0; y < rows; y++) {
            cells[y] = [];
            for (let x = 0; x < cols; x++) {
                cells[y][x] = getRandomColor();
            }
        }
    }

    function updateCells() {
        for (let y = 0; y < rows; y++) {
            for (let x = 0; x < cols; x++) {
                cells[y][x] = getRandomColor();
            }
        }
    }

    function simulationStep() {
        updateCells();
        drawGrid(ctx, width, height, cellSize, cells);
        requestAnimationFrame(simulationStep);
    }

    function initializeSimulation() {
        initializeCells();
        simulationStep();
    }

    initializeSimulation();
    console.log('Simulation initialized with continuously randomizing colored cells.');
});`
};
let lastModifiedFile = 'index.html';
let autosaveInterval = 5;
let autosaveCounter = 0;
let DIALOGUE_SCRIPTS = [
    [
        { speaker: 'Alice', text: "Hey Bob! I've been thinking about creativity and technology lately." },
        { speaker: 'Bob', text: "That's interesting! Those are two of my favorite topics. What specifically caught your attention?" },
        { speaker: 'Alice', text: "Well, I was looking at some digital art and wondering how AI might change the way we create art." },
        { speaker: 'Bob', text: "That's a fascinating intersection. As someone who loves both science and art, I see huge potential there." },
        { speaker: 'Alice', text: "Exactly! Do you think AI will enhance human creativity or potentially replace certain creative jobs?" },
        { speaker: 'Bob', text: "I believe it's more about enhancement. AI can be a powerful tool, but human creativity has unique qualities." },
        { speaker: 'Alice', text: "I agree! Like how emotions and personal experiences shape our art in ways AI might not replicate." },
        { speaker: 'Bob', text: "Yes! Plus, the creative process itself is often as valuable as the final product." },
        { speaker: 'Alice', text: "That's so true. It's about the journey and discoveries we make along the way." },
        { speaker: 'Bob', text: "Speaking of discoveries, have you tried any new creative tools lately?" },
        { speaker: 'Alice', text: "I've been experimenting with digital painting actually! It's quite different from traditional art." },
        { speaker: 'Bob', text: "That's awesome! The blend of technology and traditional techniques is really exciting." },
        { speaker: 'Alice', text: "Absolutely! It opens up so many new possibilities for expression." },
        { speaker: 'Bob', text: "And it's great to see how accessible these tools are becoming for everyone." },
        { speaker: 'Alice', text: "Yes, democratizing creativity is a wonderful thing." },
        { speaker: 'Bob', text: "Indeed. I can't wait to see what the future holds for art and technology." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you heard about the latest developments in blockchain technology?" },
        { speaker: 'Bob', text: "Yes, it's fascinating how blockchain is revolutionizing industries beyond just cryptocurrencies." },
        { speaker: 'Alice', text: "Exactly! The potential for decentralized applications is huge." },
        { speaker: 'Bob', text: "I agree. It's exciting to see how it can enhance transparency and security." },
        { speaker: 'Alice', text: "Do you think blockchain will become mainstream soon?" },
        { speaker: 'Bob', text: "It's possible, especially with the growing interest in decentralized finance." },
        { speaker: 'Alice', text: "Decentralized finance is such a game-changer, isn't it?" },
        { speaker: 'Bob', text: "Absolutely. It opens up financial services to a broader audience." },
        { speaker: 'Alice', text: "And the idea of smart contracts is just brilliant." },
        { speaker: 'Bob', text: "Smart contracts can automate so many processes, reducing the need for intermediaries." },
        { speaker: 'Alice', text: "I wonder how it will impact traditional banking." },
        { speaker: 'Bob', text: "It might push banks to innovate and adapt to new technologies." },
        { speaker: 'Alice', text: "That's true. Competition often drives progress." },
        { speaker: 'Bob', text: "Indeed. It's an exciting time for technology and finance." },
        { speaker: 'Alice', text: "I can't wait to see how it all unfolds." },
        { speaker: 'Bob', text: "Me too. The future looks promising for blockchain." }
    ],
    [
        { speaker: 'Alice', text: "Quantum technology is such a mind-bending field, don't you think?" },
        { speaker: 'Bob', text: "Absolutely! The possibilities it opens up for computing and encryption are incredible." },
        { speaker: 'Alice', text: "I wonder how soon we'll see practical applications in everyday life." },
        { speaker: 'Bob', text: "It might take some time, but the research is progressing rapidly." },
        { speaker: 'Alice', text: "Quantum computers could solve problems that are currently unsolvable." },
        { speaker: 'Bob', text: "Yes, especially in fields like cryptography and complex simulations." },
        { speaker: 'Alice', text: "The potential for breakthroughs in medicine and materials science is huge." },
        { speaker: 'Bob', text: "Indeed. Quantum simulations could lead to new drugs and materials." },
        { speaker: 'Alice', text: "It's amazing to think about the impact on industries like pharmaceuticals." },
        { speaker: 'Bob', text: "And let's not forget about the potential for revolutionizing AI." },
        { speaker: 'Alice', text: "Quantum AI could lead to more powerful and efficient algorithms." },
        { speaker: 'Bob', text: "Exactly. It could change the way we approach machine learning." },
        { speaker: 'Alice', text: "I hope we see these advancements in our lifetime." },
        { speaker: 'Bob', text: "I'm optimistic. The pace of innovation is accelerating." },
        { speaker: 'Alice', text: "True. It's an exciting time to be interested in technology." },
        { speaker: 'Bob', text: "Definitely. The future is full of possibilities." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you been following the developments in renewable energy?" },
        { speaker: 'Bob', text: "Yes, it's amazing how much progress has been made in solar and wind technologies." },
        { speaker: 'Alice', text: "I know! The efficiency of solar panels has improved so much." },
        { speaker: 'Bob', text: "And the cost has come down significantly, making it more accessible." },
        { speaker: 'Alice', text: "Do you think we'll see a major shift to renewables soon?" },
        { speaker: 'Bob', text: "I believe so. With the right policies and investments, it's possible." },
        { speaker: 'Alice', text: "The environmental benefits are undeniable." },
        { speaker: 'Bob', text: "Absolutely. Reducing carbon emissions is crucial for our planet." },
        { speaker: 'Alice', text: "And the potential for job creation in the green sector is huge." },
        { speaker: 'Bob', text: "Yes, it's a win-win situation for the economy and the environment." },
        { speaker: 'Alice', text: "I hope more countries commit to renewable energy targets." },
        { speaker: 'Bob', text: "Many are already making significant strides in that direction." },
        { speaker: 'Alice', text: "It's encouraging to see global cooperation on this issue." },
        { speaker: 'Bob', text: "Indeed. We need to work together to tackle climate change." },
        { speaker: 'Alice', text: "I'm hopeful for a sustainable future." },
        { speaker: 'Bob', text: "Me too. It's an exciting time for renewable energy." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you read about the latest advancements in space exploration?" },
        { speaker: 'Bob', text: "Yes, it's incredible how private companies are pushing the boundaries." },
        { speaker: 'Alice', text: "The idea of commercial space travel is becoming a reality." },
        { speaker: 'Bob', text: "I know! It's amazing to think that ordinary people might visit space soon." },
        { speaker: 'Alice', text: "And the plans for Mars colonization are ambitious." },
        { speaker: 'Bob', text: "Absolutely. It's a bold vision for the future of humanity." },
        { speaker: 'Alice', text: "Do you think we'll see a human on Mars in our lifetime?" },
        { speaker: 'Bob', text: "It's possible. The technology is advancing rapidly." },
        { speaker: 'Alice', text: "The potential for scientific discoveries is immense." },
        { speaker: 'Bob', text: "Yes, exploring Mars could teach us so much about our own planet." },
        { speaker: 'Alice', text: "And the search for extraterrestrial life is fascinating." },
        { speaker: 'Bob', text: "Indeed. Finding life beyond Earth would be a monumental discovery." },
        { speaker: 'Alice', text: "It's an exciting time for space enthusiasts." },
        { speaker: 'Bob', text: "Definitely. The future of space exploration looks bright." },
        { speaker: 'Alice', text: "I can't wait to see what the next decade brings." },
        { speaker: 'Bob', text: "Me too. It's a thrilling era for space exploration." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you been keeping up with the latest in artificial intelligence?" },
        { speaker: 'Bob', text: "Yes, AI is advancing at an astonishing pace." },
        { speaker: 'Alice', text: "The applications in healthcare are particularly impressive." },
        { speaker: 'Bob', text: "Absolutely. AI is helping to diagnose diseases more accurately." },
        { speaker: 'Alice', text: "And the potential for personalized medicine is huge." },
        { speaker: 'Bob', text: "Yes, AI can tailor treatments to individual patients." },
        { speaker: 'Alice', text: "Do you think AI will transform the healthcare industry?" },
        { speaker: 'Bob', text: "I believe so. It has the potential to improve outcomes and reduce costs." },
        { speaker: 'Alice', text: "And the ethical considerations are important too." },
        { speaker: 'Bob', text: "Indeed. We need to ensure AI is used responsibly." },
        { speaker: 'Alice', text: "It's a fascinating field with so much potential." },
        { speaker: 'Bob', text: "Definitely. The future of AI in healthcare is promising." },
        { speaker: 'Alice', text: "I can't wait to see how it evolves." },
        { speaker: 'Bob', text: "Me too. It's an exciting time for AI." },
        { speaker: 'Alice', text: "The possibilities are endless." },
        { speaker: 'Bob', text: "Indeed. The future is bright for AI." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you heard about the latest in autonomous vehicles?" },
        { speaker: 'Bob', text: "Yes, it's amazing how quickly the technology is developing." },
        { speaker: 'Alice', text: "The potential for reducing traffic accidents is huge." },
        { speaker: 'Bob', text: "Absolutely. Autonomous vehicles could make our roads much safer." },
        { speaker: 'Alice', text: "And the convenience of self-driving cars is appealing." },
        { speaker: 'Bob', text: "Yes, it could transform the way we commute." },
        { speaker: 'Alice', text: "Do you think we'll see widespread adoption soon?" },
        { speaker: 'Bob', text: "It's possible, but there are still challenges to overcome." },
        { speaker: 'Alice', text: "The regulatory and ethical issues are significant." },
        { speaker: 'Bob', text: "Indeed. We need to address those before widespread adoption." },
        { speaker: 'Alice', text: "It's an exciting field with so much potential." },
        { speaker: 'Bob', text: "Definitely. The future of transportation is promising." },
        { speaker: 'Alice', text: "I can't wait to see how it evolves." },
        { speaker: 'Bob', text: "Me too. It's an exciting time for autonomous vehicles." },
        { speaker: 'Alice', text: "The possibilities are endless." },
        { speaker: 'Bob', text: "Indeed. The future is bright for transportation." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you been following the developments in virtual reality?" },
        { speaker: 'Bob', text: "Yes, it's incredible how immersive VR experiences have become." },
        { speaker: 'Alice', text: "The potential for education and training is huge." },
        { speaker: 'Bob', text: "Absolutely. VR can provide realistic simulations for learning." },
        { speaker: 'Alice', text: "And the entertainment possibilities are endless." },
        { speaker: 'Bob', text: "Yes, VR is transforming the way we experience media." },
        { speaker: 'Alice', text: "Do you think VR will become mainstream soon?" },
        { speaker: 'Bob', text: "It's possible, especially with the advancements in hardware." },
        { speaker: 'Alice', text: "The potential for social interaction is fascinating." },
        { speaker: 'Bob', text: "Indeed. VR can bring people together in virtual spaces." },
        { speaker: 'Alice', text: "It's an exciting field with so much potential." },
        { speaker: 'Bob', text: "Definitely. The future of VR is promising." },
        { speaker: 'Alice', text: "I can't wait to see how it evolves." },
        { speaker: 'Bob', text: "Me too. It's an exciting time for virtual reality." },
        { speaker: 'Alice', text: "The possibilities are endless." },
        { speaker: 'Bob', text: "Indeed. The future is bright for VR." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you heard about the latest in biotechnology?" },
        { speaker: 'Bob', text: "Yes, it's amazing how much progress has been made in gene editing." },
        { speaker: 'Alice', text: "The potential for treating genetic diseases is huge." },
        { speaker: 'Bob', text: "Absolutely. CRISPR technology is a game-changer." },
        { speaker: 'Alice', text: "And the ethical considerations are important too." },
        { speaker: 'Bob', text: "Indeed. We need to ensure biotechnology is used responsibly." },
        { speaker: 'Alice', text: "It's a fascinating field with so much potential." },
        { speaker: 'Bob', text: "Definitely. The future of biotechnology is promising." },
        { speaker: 'Alice', text: "I can't wait to see how it evolves." },
        { speaker: 'Bob', text: "Me too. It's an exciting time for biotechnology." },
        { speaker: 'Alice', text: "The possibilities are endless." },
        { speaker: 'Bob', text: "Indeed. The future is bright for biotechnology." },
        { speaker: 'Alice', text: "The advancements in personalized medicine are impressive." },
        { speaker: 'Bob', text: "Yes, tailoring treatments to individuals is a huge step forward." },
        { speaker: 'Alice', text: "I hope we see these advancements in our lifetime." },
        { speaker: 'Bob', text: "I'm optimistic. The pace of innovation is accelerating." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you been keeping up with the latest in cybersecurity?" },
        { speaker: 'Bob', text: "Yes, it's incredible how important cybersecurity has become." },
        { speaker: 'Alice', text: "The potential for protecting sensitive information is huge." },
        { speaker: 'Bob', text: "Absolutely. Cybersecurity is crucial in today's digital world." },
        { speaker: 'Alice', text: "And the challenges are significant too." },
        { speaker: 'Bob', text: "Indeed. We need to stay ahead of cyber threats." },
        { speaker: 'Alice', text: "It's a fascinating field with so much potential." },
        { speaker: 'Bob', text: "Definitely. The future of cybersecurity is promising." },
        { speaker: 'Alice', text: "I can't wait to see how it evolves." },
        { speaker: 'Bob', text: "Me too. It's an exciting time for cybersecurity." },
        { speaker: 'Alice', text: "The possibilities are endless." },
        { speaker: 'Bob', text: "Indeed. The future is bright for cybersecurity." },
        { speaker: 'Alice', text: "The advancements in encryption are impressive." },
        { speaker: 'Bob', text: "Yes, protecting data is more important than ever." },
        { speaker: 'Alice', text: "I hope we see these advancements in our lifetime." },
        { speaker: 'Bob', text: "I'm optimistic. The pace of innovation is accelerating." }
    ]
    [
        { speaker: 'Alice', text: "Bob, have you heard about the advancements in 5G technology?" },
        { speaker: 'Bob', text: "Yes! It's going to revolutionize mobile connectivity." },
        { speaker: 'Alice', text: "The speed and latency improvements are incredible." },
        { speaker: 'Bob', text: "Absolutely. It will enable a whole new range of applications." },
        { speaker: 'Alice', text: "I read that it could enhance IoT devices significantly." },
        { speaker: 'Bob', text: "Exactly! More devices can connect seamlessly." },
        { speaker: 'Alice', text: "What do you think about the potential health concerns?" },
        { speaker: 'Bob', text: "It's a valid concern, but studies are ongoing." },
        { speaker: 'Alice', text: "I hope they ensure safety while rolling it out." },
        { speaker: 'Bob', text: "Me too. The benefits could be huge if done right." },
        { speaker: 'Alice', text: "Imagine smart cities powered by 5G!" },
        { speaker: 'Bob', text: "That would be amazing! Real-time data processing." },
        { speaker: 'Alice', text: "And improved public services." },
        { speaker: 'Bob', text: "Yes! Traffic management could be optimized." },
        { speaker: 'Alice', text: "I can't wait to see how it unfolds." },
        { speaker: 'Bob', text: "Same here! The future looks bright." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you explored the world of augmented reality?" },
        { speaker: 'Bob', text: "Yes! It's fascinating how it blends digital and physical worlds." },
        { speaker: 'Alice', text: "I love how it can enhance gaming experiences." },
        { speaker: 'Bob', text: "Absolutely! Pokémon GO was a game-changer." },
        { speaker: 'Alice', text: "Do you think AR will be used in education?" },
        { speaker: 'Bob', text: "Definitely! It can make learning more interactive." },
        { speaker: 'Alice', text: "Imagine history lessons with AR recreations!" },
        { speaker: 'Bob', text: "That would be incredible! Engaging students visually." },
        { speaker: 'Alice', text: "What about its applications in retail?" },
        { speaker: 'Bob', text: "AR can help customers visualize products before buying." },
        { speaker: 'Alice', text: "Exactly! It enhances the shopping experience." },
        { speaker: 'Bob', text: "And it can reduce return rates." },
        { speaker: 'Alice', text: "I wonder how quickly it will become mainstream." },
        { speaker: 'Bob', text: "With the right devices, it could be soon." },
        { speaker: 'Alice', text: "I'm excited to see where AR goes next." },
        { speaker: 'Bob', text: "Me too! The possibilities are endless." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you looked into the latest in machine learning?" },
        { speaker: 'Bob', text: "Yes! It's evolving rapidly and impacting many fields." },
        { speaker: 'Alice', text: "I find deep learning particularly interesting." },
        { speaker: 'Bob', text: "Absolutely! It's driving advancements in AI." },
        { speaker: 'Alice', text: "What do you think about its applications in healthcare?" },
        { speaker: 'Bob', text: "It's revolutionary! From diagnostics to personalized medicine." },
        { speaker: 'Alice', text: "I read about AI predicting patient outcomes." },
        { speaker: 'Bob', text: "Yes! It can analyze vast amounts of data quickly." },
        { speaker: 'Alice', text: "Do you think it will replace doctors?" },
        { speaker: 'Bob', text: "Not replace, but assist them in making better decisions." },
        { speaker: 'Alice', text: "That makes sense. Human touch is irreplaceable." },
        { speaker: 'Bob', text: "Exactly! AI should complement human expertise." },
        { speaker: 'Alice', text: "I'm curious about its ethical implications." },
        { speaker: 'Bob', text: "Ethics in AI is crucial. We need guidelines." },
        { speaker: 'Alice', text: "I hope we can navigate these challenges wisely." },
        { speaker: 'Bob', text: "Me too! The future of AI is promising." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you seen the latest trends in cybersecurity?" },
        { speaker: 'Bob', text: "Yes! Cyber threats are becoming more sophisticated." },
        { speaker: 'Alice', text: "It's alarming how often data breaches occur." },
        { speaker: 'Bob', text: "Absolutely. Companies need to prioritize security." },
        { speaker: 'Alice', text: "What do you think about the rise of zero-trust security?" },
        { speaker: 'Bob', text: "It's a smart approach! Trust no one by default." },
        { speaker: 'Alice', text: "I agree! It minimizes risks significantly." },
        { speaker: 'Bob', text: "And it encourages continuous verification." },
        { speaker: 'Alice', text: "Do you think AI will play a role in cybersecurity?" },
        { speaker: 'Bob', text: "Definitely! AI can help detect anomalies." },
        { speaker: 'Alice', text: "That could be a game-changer for threat detection." },
        { speaker: 'Bob', text: "Yes! It can analyze patterns faster than humans." },
        { speaker: 'Alice', text: "I hope organizations adopt these technologies." },
        { speaker: 'Bob', text: "Me too! It's essential for protecting data." },
        { speaker: 'Alice', text: "The future of cybersecurity is critical." },
        { speaker: 'Bob', text: "Indeed! We need to stay ahead of the curve." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you heard about the advancements in robotics?" },
        { speaker: 'Bob', text: "Yes! Robots are becoming more capable and versatile." },
        { speaker: 'Alice', text: "I find industrial robots fascinating." },
        { speaker: 'Bob', text: "Absolutely! They improve efficiency in manufacturing." },
        { speaker: 'Alice', text: "What do you think about robots in healthcare?" },
        { speaker: 'Bob', text: "They're making a big impact, especially in surgery." },
        { speaker: 'Alice', text: "I read about robotic-assisted surgeries." },
        { speaker: 'Bob', text: "Yes! They allow for precision and minimally invasive procedures." },
        { speaker: 'Alice', text: "Do you think robots will take over jobs?" },
        { speaker: 'Bob', text: "Not entirely. They will change the nature of work." },
        { speaker: 'Alice', text: "That's true! New jobs will emerge alongside automation." },
        { speaker: 'Bob', text: "Exactly! We need to adapt to these changes." },
        { speaker: 'Alice', text: "I'm excited to see how robotics evolves." },
        { speaker: 'Bob', text: "Me too! The future is bright for robotics." },
        { speaker: 'Alice', text: "I hope they enhance our lives." },
        { speaker: 'Bob', text: "Definitely! They can be powerful tools." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you explored the potential of edge computing?" },
        { speaker: 'Bob', text: "Yes! It's a game-changer for data processing." },
        { speaker: 'Alice', text: "I love how it reduces latency." },
        { speaker: 'Bob', text: "Absolutely! It brings computation closer to the data source." },
        { speaker: 'Alice', text: "What do you think about its applications in IoT?" },
        { speaker: 'Bob', text: "It's crucial! IoT devices generate massive amounts of data." },
        { speaker: 'Alice', text: "Edge computing can help manage that efficiently." },
        { speaker: 'Bob', text: "Exactly! It enables real-time analytics." },
        { speaker: 'Alice', text: "Do you think it will become mainstream?" },
        { speaker: 'Bob', text: "I believe so! As IoT grows, so will edge computing." },
        { speaker: 'Alice', text: "I'm excited to see how it develops." },
        { speaker: 'Bob', text: "Me too! The future of computing is evolving." },
        { speaker: 'Alice', text: "I hope it leads to smarter cities." },
        { speaker: 'Bob', text: "Definitely! Edge computing can enhance urban living." },
        { speaker: 'Alice', text: "The possibilities are endless." },
        { speaker: 'Bob', text: "Indeed! It's an exciting time for technology." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you heard about the latest in nanotechnology?" },
        { speaker: 'Bob', text: "Yes! It's fascinating how it can impact various fields." },
        { speaker: 'Alice', text: "I love the potential in medicine." },
        { speaker: 'Bob', text: "Absolutely! Targeted drug delivery is revolutionary." },
        { speaker: 'Alice', text: "What about its applications in materials science?" },
        { speaker: 'Bob', text: "Nanomaterials can enhance strength and durability." },
        { speaker: 'Alice', text: "Exactly! They can lead to lighter and stronger products." },
        { speaker: 'Bob', text: "Do you think it will change electronics?" },
        { speaker: 'Alice', text: "Definitely! Smaller components can lead to more powerful devices." },
        { speaker: 'Bob', text: "I'm excited about the future of nanotech." },
        { speaker: 'Alice', text: "Me too! The possibilities are vast." },
        { speaker: 'Bob', text: "I hope we see more breakthroughs soon." },
        { speaker: 'Alice', text: "Yes! It's an exciting field to watch." },
        { speaker: 'Bob', text: "The future of nanotechnology is bright." },
        { speaker: 'Alice', text: "I can't wait to see its impact." },
        { speaker: 'Bob', text: "Same here! It's a thrilling time for innovation." },
        { speaker: 'Alice', text: "The advancements are truly inspiring." },
        { speaker: 'Bob', text: "Indeed! We are on the brink of something great." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you been following the developments in quantum computing?" },
        { speaker: 'Bob', text: "Yes! It's a fascinating field with immense potential." },
        { speaker: 'Alice', text: "I love how it could solve complex problems." },
        { speaker: 'Bob', text: "Absolutely! Quantum computers can process information differently." },
        { speaker: 'Alice', text: "What do you think about its applications in cryptography?" },
        { speaker: 'Bob', text: "It's revolutionary! Quantum encryption could enhance security." },
        { speaker: 'Alice', text: "Exactly! It could make data breaches nearly impossible." },
        { speaker: 'Bob', text: "Do you think we'll see practical quantum computers soon?" },
        { speaker: 'Alice', text: "I hope so! The research is promising." },
        { speaker: 'Bob', text: "Yes! It could change industries dramatically." },
        { speaker: 'Alice', text: "I'm excited about the future of quantum tech." },
        { speaker: 'Bob', text: "Me too! The possibilities are endless." },
        { speaker: 'Alice', text: "I can't wait to see its impact on AI." },
        { speaker: 'Bob', text: "Definitely! Quantum AI could be a game-changer." },
        { speaker: 'Alice', text: "The advancements are truly inspiring." },
        { speaker: 'Bob', text: "Indeed! We are on the brink of something great." }
    ],
    [
        { speaker: 'Alice', text: "Bob, have you explored the potential of smart home technology?" },
        { speaker: 'Bob', text: "Yes! It's amazing how it can enhance our daily lives." },
        { speaker: 'Alice', text: "I love the convenience of smart devices." },
        { speaker: 'Bob', text: "Absolutely! They can automate routine tasks." },
        { speaker: 'Alice', text: "What do you think about their impact on energy efficiency?" },
        { speaker: 'Bob', text: "It's significant! Smart thermostats can save energy." },
        { speaker: 'Alice', text: "Exactly! They learn our habits and adjust accordingly." },
        { speaker: 'Bob', text: "Do you think smart homes will become the norm?" },
        { speaker: 'Alice', text: "I believe so! As technology advances, it will be more accessible." },
        { speaker: 'Bob', text: "I'm excited to see how it evolves." },
        { speaker: 'Alice', text: "Me too! The future of smart homes is bright." },
        { speaker: 'Bob', text: "I hope they enhance our quality of life." },
        { speaker: 'Alice', text: "Definitely! They can make our lives easier." },
        { speaker: 'Bob', text: "The possibilities are endless." },
        { speaker: 'Alice', text: "Indeed! It's an exciting time for technology." },
        { speaker: 'Bob', text: "I can't wait to see what comes next." }
    ]
    [
        { speaker: 'Alice', text: "Hey Bob, did you hear about the guy who invented Lifesavers?" },
        { speaker: 'Bob', text: "No, what happened?" },
        { speaker: 'Alice', text: "He made a mint!" },
        { speaker: 'Bob', text: "Haha, that's a classic!" },
        { speaker: 'Alice', text: "Speaking of mint, I just had some mint chocolate chip ice cream." },
        { speaker: 'Bob', text: "Yum! That's my favorite flavor!" },
        { speaker: 'Alice', text: "I think it’s the best way to cool down after a hot day." },
        { speaker: 'Bob', text: "Definitely! But what about farts? They can cool down a room too!" },
        { speaker: 'Alice', text: "True! But they also clear a room!" },
        { speaker: 'Bob', text: "Haha, yes! It's like a natural evacuation plan." },
        { speaker: 'Alice', text: "I wonder if there's a scientific study on the best fart sounds." },
        { speaker: 'Bob', text: "If there isn't, there should be!" },
        { speaker: 'Alice', text: "Imagine the awards for the best fart sound!" },
        { speaker: 'Bob', text: "I’d definitely want to be a judge for that!" },
        { speaker: 'Alice', text: "We could call it the 'Farty Awards'!" },
        { speaker: 'Bob', text: "And the trophy could be a golden whoopee cushion!" }
    ],
    [
        { speaker: 'Alice', text: "Bob, if you could be any animal, what would you be?" },
        { speaker: 'Bob', text: "I’d be a sloth. They seem to have it all figured out." },
        { speaker: 'Alice', text: "Really? I’d choose a dolphin. They’re so smart and playful!" },
        { speaker: 'Bob', text: "But dolphins have to swim all the time. What if they get tired?" },
        { speaker: 'Alice', text: "Good point! Maybe I’d be a cat then. They just nap all day." },
        { speaker: 'Bob', text: "Cats are great! But they also have to deal with the occasional hairball." },
        { speaker: 'Alice', text: "True! But at least they don’t have to worry about farts!" },
        { speaker: 'Bob', text: "Haha, yes! Cats are too dignified for that." },
        { speaker: 'Alice', text: "What if we could train cats to fart on command?" },
        { speaker: 'Bob', text: "That would be a viral sensation!" },
        { speaker: 'Alice', text: "We could call it 'The Farting Feline Show'!" },
        { speaker: 'Bob', text: "I’d watch that! It would be hilarious!" },
        { speaker: 'Alice', text: "And we could sell merchandise like farting cat toys!" },
        { speaker: 'Bob', text: "I can see it now: 'Farting Cats: The Ultimate Collection'!" },
        { speaker: 'Alice', text: "We’d be millionaires!" },
        { speaker: 'Bob', text: "All thanks to cat farts!" }
    ],
    [
        { speaker: 'Alice', text: "Bob, if you could invent a new holiday, what would it be?" },
        { speaker: 'Bob', text: "I’d create 'National Nap Day'!" },
        { speaker: 'Alice', text: "That sounds amazing! Everyone gets a day off to nap!" },
        { speaker: 'Bob', text: "Exactly! And we could have nap competitions!" },
        { speaker: 'Alice', text: "Haha, the winner gets a lifetime supply of pillows!" },
        { speaker: 'Bob', text: "And maybe a trophy shaped like a sleeping cat!" },
        { speaker: 'Alice', text: "What about food? We need nap snacks!" },
        { speaker: 'Bob', text: "Definitely! How about a buffet of all the best snacks?" },
        { speaker: 'Alice', text: "And we could have a 'Farting Contest' after the feast!" },
        { speaker: 'Bob', text: "Now that’s a holiday I can get behind!" },
        { speaker: 'Alice', text: "Imagine the headlines: 'Nation Celebrates Nap Day with Farting Contest'!" },
        { speaker: 'Bob', text: "It would go viral for sure!" },
        { speaker: 'Alice', text: "We’d be famous!" },
        { speaker: 'Bob', text: "All thanks to naps and farts!" },
        { speaker: 'Alice', text: "What a legacy!" },
        { speaker: 'Bob', text: "Haha, I can’t wait!" }
    ],
    [
        { speaker: 'Alice', text: "Bob, if you could have any superpower, what would it be?" },
        { speaker: 'Bob', text: "I’d want the power to make people laugh." },
        { speaker: 'Alice', text: "That’s a great one! Laughter is the best medicine." },
        { speaker: 'Bob', text: "Exactly! But I’d also want to be able to fart rainbows." },
        { speaker: 'Alice', text: "Farting rainbows? That’s a unique superpower!" },
        { speaker: 'Bob', text: "Imagine the joy it would bring!" },
        { speaker: 'Alice', text: "And the confusion!" },
        { speaker: 'Bob', text: "People would be like, 'Did that just happen?'" },
        { speaker: 'Alice', text: "Haha, yes! They’d be questioning reality!" },
        { speaker: 'Bob', text: "And I’d just smile and say, 'It’s my superpower!'" },
        { speaker: 'Alice', text: "You’d be the most popular superhero!" },
        { speaker: 'Bob', text: "I’d have my own comic book!" },
        { speaker: 'Alice', text: "And a movie deal!" },
        { speaker: 'Bob', text: "All about the adventures of 'Rainbow Fart Man'!" },
        { speaker: 'Alice', text: "I’d watch that!" },
        { speaker: 'Bob', text: "Me too! It would be a blockbuster!" },
        { speaker: 'Alice', text: "And the merchandise would fly off the shelves!" },
        { speaker: 'Bob', text: "All thanks to my magical farts!" }
    ],
    [
        { speaker: 'Alice', text: "Bob, what’s the weirdest food combination you’ve ever tried?" },
        { speaker: 'Bob', text: "I once had peanut butter and pickles." },
        { speaker: 'Alice', text: "Ew! How was that?" },
        { speaker: 'Bob', text: "Surprisingly good! But it made me gassy." },
        { speaker: 'Alice', text: "Haha, I can imagine!" },
        { speaker: 'Bob', text: "I think I invented a new fart flavor!" },
        { speaker: 'Alice', text: "What would you call it?" },
        { speaker: 'Bob', text: "The 'Pickle Puff'!" },
        { speaker: 'Alice', text: "That sounds like a hit!" },
        { speaker: 'Bob', text: "We could market it as a snack!" },
        { speaker: 'Alice', text: "And have a farting contest to promote it!" },
        { speaker: 'Bob', text: "Haha, yes! The 'Pickle Puff Challenge'!" },
        { speaker: 'Alice', text: "I can see the commercials now!" },
        { speaker: 'Bob', text: "All the cool kids will be doing it!" },
        { speaker: 'Alice', text: "And we’ll be rich!" },
        { speaker: 'Bob', text: "All thanks to pickles and farts!" }
    ],
    [
        { speaker: 'Alice', text: "Bob, if you could time travel, where would you go?" },
        { speaker: 'Bob', text: "I’d go back to the dinosaur age!" },
        { speaker: 'Alice', text: "That would be awesome! But also scary!" },
        { speaker: 'Bob', text: "True! But I’d bring a fart machine!" },
        { speaker: 'Alice', text: "Haha, why?" },
        { speaker: 'Bob', text: "To confuse the dinosaurs!" },
        { speaker: 'Alice', text: "That’s genius! They’d be like, 'What is that noise?'" },
        { speaker: 'Bob', text: "And I’d just laugh while they run away!" },
        { speaker: 'Alice', text: "You’d be the first time traveler to scare dinosaurs!" },
        { speaker: 'Bob', text: "I’d be a legend!" },
        { speaker: 'Alice', text: "And you’d have the best stories!" },
        { speaker: 'Bob', text: "All thanks to my fart machine!" },
        { speaker: 'Alice', text: "I can’t wait to hear those tales!" },
        { speaker: 'Bob', text: "They’d be epic!" },
        { speaker: 'Alice', text: "And totally ridiculous!" },
        { speaker: 'Bob', text: "Just like us!" }
    ],
    [
        { speaker: 'Alice', text: "Bob, what’s your favorite joke?" },
        { speaker: 'Bob', text: "Why don’t scientists trust atoms?" },
        { speaker: 'Alice', text: "I don’t know, why?" },
        { speaker: 'Bob', text: "Because they make up everything!" },
        { speaker: 'Alice', text: "Haha, that’s a classic!" },
        { speaker: 'Bob', text: "But I have a fart joke too!" },
        { speaker: 'Alice', text: "Oh, let’s hear it!" },
        { speaker: 'Bob', text: "What did one fart say to the other?" },
        { speaker: 'Alice', text: "I give up!" },
        { speaker: 'Bob', text: "‘You crack me up!’" },
        { speaker: 'Alice', text: "Haha, that’s great!" },
        { speaker: 'Bob', text: "I think I should start a comedy career!" },
        { speaker: 'Alice', text: "You’d be a hit!" },
        { speaker: 'Bob', text: "All thanks to my fart jokes!" },
        { speaker: 'Alice', text: "I can see the headlines now!" },
        { speaker: 'Bob', text: "‘The Farting Comedian Takes the Stage!’" }
    ],
    [
        { speaker: 'Alice', text: "Bob, if you could have a pet, what would it be?" },
        { speaker: 'Bob', text: "I’d want a pet dragon!" },
        { speaker: 'Alice', text: "That would be awesome! But also dangerous!" },
        { speaker: 'Bob', text: "True! But I’d train it to fart fire!" },
        { speaker: 'Alice', text: "Haha, that would be a sight!" },
        { speaker: 'Bob', text: "Imagine the BBQ parties!" },
        { speaker: 'Alice', text: "You’d be the life of the party!" },
        { speaker: 'Bob', text: "And everyone would want to come over!" },
        { speaker: 'Alice', text: "But what if it accidentally burned the house down?" },
        { speaker: 'Bob', text: "Then I’d have to get a fire extinguisher!" },
        { speaker: 'Alice', text: "And a good insurance policy!" },
        { speaker: 'Bob', text: "Haha, yes! But it would be worth it!" },
        { speaker: 'Alice', text: "Definitely! A farting dragon would be legendary!" },
        { speaker: 'Bob', text: "I’d be famous!" },
        { speaker: 'Alice', text: "All thanks to your dragon’s farts!" },
        { speaker: 'Bob', text: "What a legacy!" }
    ],
    [
        { speaker: 'Alice', text: "Bob, what’s your favorite childhood memory?" },
        { speaker: 'Bob', text: "I remember the time I tried to make a rocket out of soda bottles." },
        { speaker: 'Alice', text: "That sounds fun! Did it work?" },
        { speaker: 'Bob', text: "Not really. It just fizzed and made a huge mess!" },
        { speaker: 'Alice', text: "Haha, classic science experiment!" },
        { speaker: 'Bob', text: "But the best part was when my dog farted and scared me!" },
        { speaker: 'Alice', text: "Oh no! What happened?" },
        { speaker: 'Bob', text: "I jumped and spilled soda everywhere!" },
        { speaker: 'Alice', text: "That’s hilarious!" },
        { speaker: 'Bob', text: "I think my dog was trying to help!" },
        { speaker: 'Alice', text: "With the rocket or the fart?" },
        { speaker: 'Bob', text: "Both! He was my little sidekick!" },
        { speaker: 'Alice', text: "You should write a book about your adventures!" },
        { speaker: 'Bob', text: "I could call it 'Farts and Rockets'!" },
        { speaker: 'Alice', text: "That would be a bestseller!" },
        { speaker: 'Bob', text: "All thanks to my dog!" },
        { speaker: 'Alice', text: "And his epic farts!" }
    ]
];
let currentDialogueIndex = 0;
async function loadForbiddenKeywords() {
  try {
    const response = await fetch('https://raw.githubusercontent.com/sophxine/llm-forbidden-code/main/forbidden.txt');
    const text = await response.text();
    const forbiddenKeywords = text.split('\n').filter(keyword => keyword.trim() !== '');
    return forbiddenKeywords;
  } catch (error) {
    console.error('Error loading forbidden keywords:', error);
    return [];
  }
}
async function cleanJson(jsonString) {
  try {
    const response = await fetch('/api/json-cleaner', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        jsonString
      })
    });
    if (!response.ok) {
      throw new Error(`API response error: ${response.status}`);
    }
    const cleanedJson = await response.json();
    return cleanedJson;
  } catch (error) {
    console.error('Error cleaning JSON:', error);
    return null;
  }
}
function sanitizeHTML(str) {
  const temp = document.createElement('div');
  temp.textContent = str;
  return temp.innerHTML;
}
function addChatMessage(message, sender) {
  const messageElement = document.createElement('div');
  messageElement.className = `message ${sender.toLowerCase()}`;
  messageElement.innerHTML = `<strong>${sanitizeHTML(sender)}:</strong> ${sanitizeHTML(message)}`;
  chatLog.appendChild(messageElement);
  chatLog.scrollTop = chatLog.scrollHeight;
  if (sender === "Console" || sender === "Error") {
    AGENTS.forEach(agent => {
      agent.context.push(`${sender}: ${message}`);
    });
  }
}
function logError(error) {
  addChatMessage(`Error: ${error}`, "Error");
}
function updateFileExplorer() {
  fileExplorer.innerHTML = '';
  Object.keys(files).forEach(fileName => {
    const fileItem = document.createElement('div');
    fileItem.className = 'file-item';
    fileItem.textContent = fileName;
    fileItem.onclick = () => displayFile(fileName);
    fileExplorer.appendChild(fileItem);
  });
}
function displayFile(fileName) {
  lastModifiedFile = fileName;
  updateFileDisplay();
}
function updateFileDisplay() {
  if (lastModifiedFile) {
    fileDisplay.textContent = `File: ${lastModifiedFile}\n\nContent:\n${files[lastModifiedFile]}`;
  } else {
    fileDisplay.textContent = "No file selected.";
  }
}
function runJSHint(fileName, code) {
  JSHINT(code);
  const errors = JSHINT.errors;
  if (errors.length > 0) {
    errors.forEach(error => {
      if (error) {
        addChatMessage(`JSHint: ${fileName} - Line ${error.line}, Col ${error.character}: ${error.reason}`, "System");
      }
    });
  }
}
function processFileActions(actions) {
  let indexHtmlModified = false;
  actions.forEach(action => {
    switch (action.action) {
      case 'new':
        if (action.name.endsWith('.js') && !action.content.startsWith('/* jshint esversion: 11 */')) {
          action.content = `/* jshint esversion: 11 */\n${action.content}`;
        }
        files[action.name] = action.content;
        lastModifiedFile = action.name;
        if (action.name === 'index.html') indexHtmlModified = true;
        if (action.name.endsWith('.js')) {
          runJSHint(action.name, action.content);
        }
        break;
      case 'rename':
        if (files[action.oldName]) {
          files[action.newName] = files[action.oldName];
          delete files[action.oldName];
          lastModifiedFile = action.newName;
          if (action.oldName === 'index.html' || action.newName === 'index.html') indexHtmlModified = true;
        }
        break;
      case 'delete':
        delete files[action.name];
        lastModifiedFile = null;
        if (action.name === 'index.html') indexHtmlModified = true;
        break;
      case 'edit':
        if (action.name.endsWith('.js') && !action.content.startsWith('/* jshint esversion: 11 */')) {
          action.content = `/* jshint esversion: 11 */\n${action.content}`;
        }
        files[action.name] = action.content;
        lastModifiedFile = action.name;
        if (action.name === 'index.html') indexHtmlModified = true;
        if (action.name.endsWith('.js')) {
          runJSHint(action.name, action.content);
        }
        break;
    }
  });
  updateFileExplorer();
  updateFileDisplay();
}
function checkForbiddenKeywords(response) {
  const forbiddenKeywords = loadForbiddenKeywords();
  const foundKeywords = forbiddenKeywords.filter(keyword => response.toLowerCase().includes(keyword.toLowerCase()));
  if (foundKeywords.length > 0) {
    const message = `You commented out code using ${foundKeywords.join(', ')}. You cannot skip code in this environment.`;
    addChatMessage(message, "System");
    return true;
  }
  return false;
}
async function getAgentAction(agent, userInput = '') {
  const context = `
    ${agent.specificInstructions}
    
    You are engaged in a natural conversation with the other agent. Generate a conversational response based on the context of previous messages.
    Keep responses casual and natural, as if two friends talking.

    Previous context:
    ${agent.context.slice(-5).join('\n')}

    ${userInput ? `User input: ${userInput}` : ''}

    Create a natural conversational response. No need for file actions unless specifically relevant to the conversation.
    Your response should be in JSON format with 'response' field.
    
    Example response format:
    {
      "response": "Your conversational message here",
      "fileActions": []
    }
  `;
  const maxRetries = 3;
  let retries = 0;
  while (retries < maxRetries) {
    try {
      const response = await fetch('/api/intelligent-ai', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          message: context,
          system: agent.specificInstructions || generalAgentInstructions
        })
      });
      if (!response.ok) {
        throw new Error(`API response error: ${response.status}`);
      }
      const rawData = await response.text();
      if (checkForbiddenKeywords(rawData)) {
        return {
          response: "The agent's response contained forbidden keywords and was cancelled.",
          fileActions: []
        };
      }
      let data;
      try {
        data = JSON.parse(rawData);
      } catch (error) {
        const cleanedData = await cleanJson(rawData);
        if (cleanedData) {
          data = cleanedData;
        } else {
          throw new Error('Failed to parse and clean JSON');
        }
      }
      if (!data.response || !data.fileActions) {
        throw new Error(`Invalid response format for ${agent.name}: ${JSON.stringify(data)}`);
      }
      return data;
    } catch (error) {
      retries++;
      if (retries >= maxRetries) {
        logError(`Error for ${agent.name} after ${maxRetries} attempts: ${error}`);
        return {
          response: "The agent encountered an error and couldn't respond after multiple attempts.",
          fileActions: []
        };
      }
      addChatMessage(`Retrying agent action for ${agent.name} (attempt ${retries + 1})...`, "System");
    }
  }
}
function showThinking(agentName) {
  const thinkingMessage = document.createElement('div');
  thinkingMessage.className = 'message system thinking-message';
  thinkingMessage.innerHTML = `<strong>System:</strong> ${agentName} is thinking...`;
  chatLog.appendChild(thinkingMessage);
  chatLog.scrollTop = chatLog.scrollHeight;
  return thinkingMessage;
}
async function simulationStep(userInput = '') {
  if (userInput) {
    addChatMessage(userInput, userNickname);
  }
  if (!isSimulationRunning || isProcessingAgent) {
    return;
  }
  isProcessingAgent = true;
  try {
    if (currentDialogueIndex >= DIALOGUE_SCRIPT.length) {
      stopSimulation();
      addChatMessage("Dialogue complete", "System");
      return;
    }
    const currentLine = DIALOGUE_SCRIPT[currentDialogueIndex];
    const thinkingMessage = showThinking(currentLine.speaker);
    await new Promise(resolve => setTimeout(resolve, 2000));
    thinkingMessage.remove();
    addChatMessage(currentLine.text, currentLine.speaker);
    currentDialogueIndex++;
    updateContextInfo();
    autosaveCounter++;
    if (autosaveCounter >= autosaveInterval) {
      autosave();
      autosaveCounter = 0;
    }
  } finally {
    isProcessingAgent = false;
  }
  if (isSimulationRunning) {
    setTimeout(() => simulationStep(), 3000);
  }
}
function updateContextInfo() {
  contextInfo.innerHTML = `
    <h3>Current Agents:</h3>
    <ul>
      ${AGENTS.map((agent, index) => `<li>${sanitizeHTML(agent.name)}${index === currentAgentIndex ? '' : ''}</li>`).join('')}
    </ul>
    <p><strong>Simulation Status:</strong> ${isSimulationRunning ? 'Running' : 'Stopped'}</p>
    <p><strong>Your Nickname:</strong> ${sanitizeHTML(userNickname)}</p>
    <p><strong>Autosave Interval:</strong> Every ${autosaveInterval} agent actions</p>
  `;
}
function startSimulation() {
    if (!isSimulationRunning) {
        isSimulationRunning = true;
        currentDialogueIndex = 0;
        const randomIndex = Math.floor(Math.random() * DIALOGUE_SCRIPTS.length);
        DIALOGUE_SCRIPT = DIALOGUE_SCRIPTS[randomIndex];
        addChatMessage("Starting scripted dialogue between Alice and Bob", "System");
        simulationStep();
    } else {
        addChatMessage("Dialogue is already running", "System");
    }
    updateContextInfo();
}

function stopSimulation() {
  isSimulationRunning = false;
  currentDialogueIndex = 0;
  addChatMessage("Dialogue stopped", "System");
  updateContextInfo();
}
function addAgent(name) {}
function removeAgent(name) {}
function setInstructions(agentName, instructions) {}
function setNickname(newNickname) {
  if (newNickname) {
    userNickname = newNickname;
    addChatMessage(`Your nickname has been set to: ${sanitizeHTML(userNickname)}`, "System");
    updateContextInfo();
  } else {
    logError("Invalid nickname. Please provide a non-empty nickname.");
  }
}
function loadInstructions(jsonContent) {
  try {
    const instructionsData = JSON.parse(jsonContent);
    if (Array.isArray(instructionsData.dialogue)) {
      DIALOGUE_SCRIPT = instructionsData.dialogue;
      currentDialogueIndex = 0;
      addChatMessage("New dialogue script loaded", "System");
    }
    updateContextInfo();
  } catch (error) {
    logError(`Error parsing dialogue JSON: ${error.message}`);
  }
}
function setAutosaveInterval(interval) {
  if (interval > 0) {
    autosaveInterval = interval;
    autosaveCounter = 0;
    addChatMessage(`Autosave interval set to every ${interval} agent actions`, "System");
    updateContextInfo();
  } else {
    logError("Invalid autosave interval. Please provide a positive number.");
  }
}
function autosave() {
  const saveData = {
    files,
    AGENTS,
    generalAgentInstructions,
    userNickname,
    chatHistory: []
  };
  const saveKey = `autosave_${Date.now()}`;
  localStorage.setItem(saveKey, JSON.stringify(saveData));
  updateAutosaveList();
  addChatMessage("Autosave completed", "System");
}
function updateAutosaveList() {
  autosaveList.innerHTML = '';
  const autosaves = [];
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.startsWith('autosave_')) {
      autosaves.push({
        key: key,
        timestamp: parseInt(key.split('_')[1])
      });
    }
  }
  autosaves.sort((a, b) => b.timestamp - a.timestamp);
  autosaves.forEach(save => {
    const saveDate = new Date(save.timestamp);
    const saveItem = document.createElement('div');
    saveItem.className = 'autosave-item';
    saveItem.innerHTML = `
      ${saveDate.toLocaleString()}
      <button onclick="loadAutosave('${save.key}')">Load</button>
      <button onclick="deleteAutosave('${save.key}')">Delete</button>
      <button onclick="clearAutosaveChat('${save.key}')">Clear Chat</button>
    `;
    autosaveList.appendChild(saveItem);
  });
}
function loadAutosave(key) {
  const saveData = JSON.parse(localStorage.getItem(key));
  files = saveData.files;
  AGENTS = saveData.AGENTS;
  generalAgentInstructions = saveData.generalAgentInstructions;
  userNickname = saveData.userNickname;
  updateFileExplorer();
  updateFileDisplay();
  updateContextInfo();
  addChatMessage(`Autosave from ${new Date(parseInt(key.split('_')[1])).toLocaleString()} loaded`, "System");
}
function deleteAutosave(key) {
  localStorage.removeItem(key);
  updateAutosaveList();
  addChatMessage(`Autosave from ${new Date(parseInt(key.split('_')[1])).toLocaleString()} deleted`, "System");
}
function clearAutosaveChat(key) {
  const saveData = JSON.parse(localStorage.getItem(key));
  saveData.chatHistory = [];
  localStorage.setItem(key, JSON.stringify(saveData));
  updateAutosaveList();
  addChatMessage(`Chat cleared for autosave from ${new Date(parseInt(key.split('_')[1])).toLocaleString()}`, "System");
}
function clearChat() {
  chatLog.innerHTML = '';
  addChatMessage("Chat cleared", "System");
}
function help() {
  addChatMessage("Available commands:", "System");
  addChatMessage("!ca - See contact address", "System");
  addChatMessage("!start - Start or resume the dialogue", "System");
  addChatMessage("!stop - Stop the dialogue", "System");
  addChatMessage("!nick [nickname] - Set your nickname", "System");
  addChatMessage("!load [JSON] - Load new dialogue script", "System");
  addChatMessage("!autosaveevery [number] - Set autosave interval", "System");
  addChatMessage("!save - Save the chatlog and files", "System");
  addChatMessage("!clear - Clear the chat", "System");
  addChatMessage("!help - Show this help message", "System");
}
function processCommand(input) {
  if (!input.startsWith('!')) {
    simulationStep(input);
    return;
  }
  const [command, ...args] = input.slice(1).split(' ');
  switch (command.toLowerCase()) {
    case 'start':
      startSimulation();
      break;
    case 'stop':
      stopSimulation();
      break;
      case 'ca':
            addChatMessage("Soon... @SwornAFsol on X", "System");
            break;
    case 'add':
      addAgent(args[0]);
      break;
    case 'remove':
      removeAgent(args[0]);
      break;
    case 'set':
      setInstructions(args[0], args.slice(1).join(' '));
      break;
    case 'list':
      addChatMessage(`Agents: ${AGENTS.map(a => sanitizeHTML(a.name)).join(', ')}`, "System");
      break;
    case 'nick':
      setNickname(args.join(' '));
      break;
    case 'load':
      loadInstructions(args.join(' '));
      break;
    case 'autosaveevery':
      setAutosaveInterval(parseInt(args[0]));
      break;
    case 'save':
      autosave();
      break;
    case 'clear':
      clearChat();
      break;
    case 'help':
      help();
      break;
    default:
      addChatMessage(`Unknown command: ${sanitizeHTML(command)}. Type !help for a list of commands.`, "System");
  }
}
userInput.addEventListener('keydown', function (e) {
  if (e.key === 'Enter') {
    const input = this.value.trim();
    if (input) {
      processCommand(input);
      this.value = '';
    }
  } else if (e.key === 'ArrowUp') {
    e.preventDefault();
  } else if (e.key === 'ArrowDown') {
    e.preventDefault();
  }
});
async function exportFiles() {
  const zip = new JSZip();
  Object.entries(files).forEach(([fileName, content]) => {
    zip.file(fileName, content);
  });
  const zipBlob = await zip.generateAsync({
    type: "blob"
  });
  const formData = new FormData();
  formData.append("file", zipBlob, "project.zip");
  try {
    const response = await fetch("https://file.io", {
      method: "POST",
      body: formData
    });
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    const data = await response.json();
    if (data.success && data.link) {
      window.open(data.link, '_blank');
      addChatMessage(`Files exported successfully. Download link: ${sanitizeHTML(data.link)}`, "System");
    } else {
      throw new Error("Failed to get download link from file.io");
    }
  } catch (error) {
    logError(`Error exporting files: ${error.message}`);
  }
}
exportButton.addEventListener('click', exportFiles);
updateContextInfo();
updateFileExplorer();
updateFileDisplay();
addChatMessage("Welcome to Sworn Agents Framework. Type '!start' to begin the simulation or '!help' for a list of commands.", "System");</script>
</body></html>
